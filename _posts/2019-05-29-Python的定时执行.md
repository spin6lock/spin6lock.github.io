---
layout:     post
title:      Python çš„å®šæ—¶æ‰§è¡Œ
subtitle:   
date:       2019-05-29
author:     spin6lock
header-img: img/post-bg-mma-6.jpg
catalog: true
tags:
    - python
---
æœ€è¿‘æ‰‹æŠŠæ‰‹æ•™å¦¹å­å†™ Pythonï¼Œè¢«ä¸€ç¯‡åšå®¢è¯¯å¯¼äº†ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹ã€‚

å¦¹å­éœ€è¦çš„æ˜¯ä¸€ä¸ªå®šæ—¶é—¹é’Ÿï¼Œåˆ°ç‚¹å¾€é’‰é’‰ç¾¤é‡Œæ¨ä¸ªæ¶ˆæ¯ã€‚å¥¹ä¸€é¡¿æœç´¢çŒ›å¦‚è™ï¼Œå‚ç…§ç€å…¶ä»–äººçš„åšå®¢ï¼Œæäº†ä¸€ä¸ª whileï¼š

```
target_time = mktime(time.strptime("2019-5-29 15:30:00", "%Y-%m-%d %H:%M:%S"))

while True:
   now = time.time()
   if now > target_time:
       print(u" åˆ°ç‚¹ ")
       break
```

è¿™ç§æ²¡å•¥æŠ€æœ¯å«é‡çš„ä»£ç ï¼Œå±…ç„¶æœ‰äººå ‚è€Œçš‡ä¹‹å†™åœ¨åšå®¢é‡Œï¼Œç®€ç›´æ˜¯è¯¯å¯¼å˜›ã€‚ã€‚ã€‚è·‘èµ·æ¥ä»¥å CPU ä¸€ä¸ªæ ¸å°±åœ¨ç©ºè·‘ï¼Œç­‰ç€æ—¶é—´åˆ°äº†ï¼Œè·Ÿ [ ç¡çœ æ’åº ](https://www.jianshu.com/p/4f526ea40df4) çš„ xx ç¨‹åº¦å¯ä»¥ä¸€æ‹¼

äºæ˜¯å…ˆè®©å¦¹å­æå¥½å‘é’‰é’‰çš„ä»£ç ï¼Œå°è£…ä¸€ä¸ªç»™æ–‡æœ¬å°±èƒ½æ¨é’‰é’‰æœºå™¨äººçš„å°å‡½æ•°å‡ºæ¥ï¼š

```
import requests
import json
def _notify_dd(text):
        ding_msg = {
            "msgtype": "text",
            "text": 
            {
                "content": text,
                "title":" title"
             }
        }
        robotUrl = "xxxx" # è‡ªå·±å¡«é’‰é’‰æœºå™¨äºº url
        headers = {"Content-Type":"application/json"}
        requests.post(robotUrl, data = json.dumps(ding_msg), headers = headers)
```

æ¥ä¸‹æ¥å°±æ˜¯å®šæ—¶å™¨çš„éƒ¨åˆ†ï¼Œä¹‹å‰æˆ‘æ˜¯æƒ³ç€ç»™å¥¹å¼€ä¸€ä¸ª Linux ç”¨æˆ·ï¼Œç„¶åç”¨ crontab è·‘ã€‚åæ¥å‘ç° Python æœ‰ä¸ªæ¨¡å— schedï¼Œå¯ä»¥å®šæ—¶æ‰§è¡Œï¼Œç¤ºä¾‹ä»£ç ï¼š

```
import sched, time
s = sched.scheduler(time.time, time.sleep)
def print_time(a='default'):
    print("From print_time", time.time(), a)

def print_some_times():
    print(time.time())
    s.enter(10, 1, print_time)
    s.enter(5, 2, print_time, argument=('positional',))
    s.enter(5, 1, print_time, kwargs={'a': 'keyword'})
    s.run()
    
```

è¿™é‡Œè°ƒäº†ï¼šsched.schedulerã€s.enterã€s.run ä¸‰ä¸ªæ–¹æ³•ã€‚ç¬¬ä¸€ä¸ªæ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªè°ƒåº¦å™¨ï¼Œé‡‡ç”¨ time.sleep é˜»å¡ç­‰å¾…ï¼Œtime.time è¿”å›å½“å‰æ—¶é—´ã€‚s.enter æ˜¯æ’å…¥å®šæ—¶æ‰§è¡Œäº‹ä»¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯éœ€è¦ç­‰å¾…çš„æ—¶é—´ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¼˜å…ˆçº§ï¼Œæ—¶é—´ç›¸åŒæŒ‰ä¼˜å…ˆçº§æ‰§è¡Œï¼Œç¬¬ä¸‰ä¸ªæ˜¯éœ€è¦æ‰§è¡Œçš„å‡½æ•° actionï¼Œåé¢çš„å‚æ•°æ˜¯ä¼ ç»™ action çš„å‚æ•°ã€‚ç¬¬ä¸‰ä¸ª s.run æ˜¯æ‰§è¡Œé˜»å¡ï¼Œç­‰å¾…äº‹ä»¶æ‰§è¡Œ

æœ€åï¼Œåªè¦ç»“åˆ time.mktime æ¥ç®—ä¸‹ç›®æ ‡æ—¶é—´çš„æ—¶é—´æˆ³ï¼Œç„¶åå’Œå½“å‰æ—¶é—´ç›¸å‡ç®—ä¸‹ç­‰å¾…æ—¶é—´ï¼Œäº¤ç»™ sched å»æ‰§è¡Œå°±è¡Œäº† ğŸ˜„ å¦‚æœéœ€è¦å¾ªç¯æ‰§è¡Œï¼Œå¯ä»¥è€ƒè™‘ç”¨ schedule è¿™ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œè¯­æ³•æ¯”è¾ƒå‹å¥½

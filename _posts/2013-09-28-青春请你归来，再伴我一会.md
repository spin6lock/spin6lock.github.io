---
layout:     post
title:      青春请你归来，再伴我一会
subtitle:   
date:       2013-09-28
author:     spin6lock
header-img: img/post-bg-e2e-ux.jpg
catalog: true
tags:
    - python
---
加班到12点，走出公司的时候，发现大街上伴我同行的，只有一大帮小姐了，so sad

持续加班获得的效率红利已经渐渐消失，前面留下的技术债越来越成为前进的障碍。发版本的前一晚，提交频率非常高，经常有人抱怨更新后进不去游戏。客户端没有人搞单元测试，偏偏脚本又无法通过静态编译消灭一部分低级错误。于是，就变成了《唐伯虎点秋香》那一幕：

<img src="http://images.cnitblog.com/blog/90397/201309/28180549-13696b09c42c4140ac6fd4b4a9c0619d.jpg" alt="" width="453" height="254" /><img src="http://images.cnitblog.com/blog/90397/201309/28180622-8feb1fc94f274084a66bdc4a0609c936.jpg" alt="" width="455" height="256" />

本周主要做的是公会的公告板系统。一般公会的聊天都是纯文本，只要记得记录就好，但是coc的公会还有同意和拒绝这种操作，以及捐兵，而且这两项还是实时推送。推送消息的时候，需要考虑到接受消息人的公会位置，普通成员要过滤掉部分信息。操作主要分成两步，一是修改原有的消息记录，另一个是发消息操作到客户端去。

同时，客户端还解决了一个内存越界访问的bug。这个bug出现在地图寻路的时候，将地图块从脚本层传到C层，由于地图块的错误，导致访存越界。这个错误在真机上会不定时崩，在win下的模拟器上跑，会报堆访问出错。最终改为在栈上分配这个空间解决。
